<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Space Shooter - Kc</title>

  <!-- Google Font -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet" />

  <!-- Tone.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>

  <style>
    :root { --bg:#0a0a1a; --accent:#00ffff; --hud:#00ffbe; }
    html,body { height:100%; margin:0; font-family:'Orbitron',sans-serif; background:var(--bg); color:#fff; display:flex; align-items:center; justify-content:center; }
    #game-container { text-align:center; width:100%; max-width:900px; padding:8px; box-sizing:border-box; }
    h1 { color:var(--accent); margin:6px 0 10px; text-shadow:0 0 12px rgba(0,255,255,0.12); }
    canvas { width:100%; height:auto; display:block; border-radius:10px; box-shadow:0 0 20px rgba(0,255,255,0.08); background:linear-gradient(#000,#051028); }
    #overlayText { color:var(--accent); text-shadow:0 0 10px rgba(0,255,255,0.12); margin-top:8px; }
    @media (max-width:520px){ h1{font-size:20px} #overlayText{font-size:13px} }
  </style>
</head>
<body>
  <div id="game-container">
    <h1>Space Shooter</h1>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <div id="overlayText"></div>
  </div>

  <script>
    // Canvas and context
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    // Assets (placeholder images)
    const assets = {
      player: new Image(),
      bullet: new Image(),
      asteroid: new Image(),
      chaser: new Image(),
      dodger: new Image(),
      shieldPowerUp: new Image(),
      fuelPowerUp: new Image(),
    };
    assets.player.src = 'https://placehold.co/64x64/00ffff/000000?text=▶';
    assets.bullet.src = 'https://placehold.co/16x16/ffff00/000000?text=•';
    assets.asteroid.src = 'https://placehold.co/64x64/ff4444/000000?text=A';
    assets.chaser.src = 'https://placehold.co/50x50/ff8800/000000?text=C';
    assets.dodger.src = 'https://placehold.co/50x50/ff00ff/000000?text=D';
    assets.shieldPowerUp.src = 'https://placehold.co/40x40/00ff00/000000?text=S';
    assets.fuelPowerUp.src = 'https://placehold.co/40x40/ffffff/000000?text=F';

    // Tone.js sounds
    const collisionSound = new Tone.Synth({ oscillator:{type:'fmsquare'}, envelope:{attack:0.005,decay:0.15,sustain:0.05,release:0.1} }).toDestination();
    const shootSound = new Tone.MembraneSynth({ pitchDecay:0.02, envelope:{attack:0.001,decay:0.2,sustain:0.01,release:0.1} }).toDestination();
    const pickupSound = new Tone.Synth({ oscillator:{type:'triangle'}, envelope:{attack:0.01,decay:0.2,sustain:0.1,release:0.1} }).toDestination();

    // State
    let score = 0;
    let gameOver = false;
    let gameStarted = false;
    const keys = {};

    // Player
    class Player {
      constructor() {
        this.width = 64; this.height = 64;
        this.x = canvas.width/2 - this.width/2;
        this.y = canvas.height - this.height - 20;
        this.speed = 7;
        this.bullets = [];
        this.shootCooldown = 0;
        this.maxFuel = 100; this.fuel = this.maxFuel;
        this.shieldActive = false; this.shieldTimer = 0;
      }
      update() {
        if (keys['ArrowLeft']||keys['KeyA']) this.x -= this.speed;
        if (keys['ArrowRight']||keys['KeyD']) this.x += this.speed;
        this.x = Math.max(0, Math.min(this.x, canvas.width - this.width));

        if ((keys['Space']||keys['KeyZ']) && this.shootCooldown <= 0) {
          this.shoot(); this.shootCooldown = 14; shootSound.triggerAttackRelease('C3','8n');
        }
        if (this.shootCooldown>0) this.shootCooldown--;

        for (let i=this.bullets.length-1;i>=0;i--){
          this.bullets[i].update();
          if (this.bullets[i].y + this.bullets[i].height < 0) this.bullets.splice(i,1);
        }

        this.fuel -= 0.035;
        if (this.fuel <= 0) { this.fuel = 0; gameOver = true; }

        if (this.shieldActive) {
          this.shieldTimer--; if (this.shieldTimer <= 0) this.shieldActive = false;
        }
      }
      draw(){
        ctx.drawImage(assets.player, this.x, this.y, this.width, this.height);
        if (this.shieldActive){
          ctx.beginPath();
          ctx.arc(this.x+this.width/2, this.y+this.height/2, this.width/2+8,0,Math.PI*2);
          ctx.fillStyle='rgba(0,255,255,0.12)'; ctx.fill();
          ctx.strokeStyle='rgba(0,255,255,0.6)'; ctx.lineWidth=2; ctx.stroke();
        }
        this.bullets.forEach(b=>b.draw());
      }
      shoot(){ this.bullets.push(new Bullet(this.x + this.width/2, this.y)); }
      activateShield(){ this.shieldActive = true; this.shieldTimer = 300; }
      addFuel(amount=45){ this.fuel = Math.min(this.maxFuel, this.fuel + amount); }
    }

    class Bullet {
      constructor(x,y){ this.width=12; this.height=20; this.x=x - this.width/2; this.y=y - this.height; this.speed=10; }
      update(){ this.y -= this.speed; }
      draw(){ ctx.drawImage(assets.bullet,this.x,this.y,this.width,this.height); }
    }

    class Competitor {
      constructor(image,w,h,speed){ this.image=image; this.width=w; this.height=h; this.x=Math.random()*(canvas.width-this.width); this.y=-this.height - Math.random()*200; this.speed=speed; }
      update(){ this.y += this.speed; }
      draw(){ ctx.drawImage(this.image,this.x,this.y,this.width,this.height); }
    }

    class Asteroid extends Competitor {
      constructor(){ super(assets.asteroid,64,64,Math.random()*1.8+1.6); this.rotation=Math.random()*Math.PI*2; this.rotSpeed=(Math.random()-0.5)*0.03; }
      update(){ super.update(); this.rotation += this.rotSpeed; }
      draw(){ ctx.save(); ctx.translate(this.x+this.width/2,this.y+this.height/2); ctx.rotate(this.rotation); ctx.drawImage(this.image,-this.width/2,-this.height/2,this.width,this.height); ctx.restore(); }
    }

    class Chaser extends Competitor {
      constructor(){ super(assets.chaser,50,50,Math.random()*1.2+1.0); }
      update(){ super.update(); if (player.x+player.width/2 > this.x+this.width/2) this.x += this.speed*0.6; else this.x -= this.speed*0.6; this.x = Math.max(0, Math.min(this.x, canvas.width - this.width)); }
    }

    class Dodger extends Competitor {
      constructor(){ super(assets.dodger,50,50,Math.random()*2.5+2.0); }
      update(){ super.update(); for (let b of player.bullets){ const dx=(b.x+b.width/2)-(this.x+this.width/2); const dy=(b.y+b.height/2)-(this.y+this.height/2); const dist = Math.hypot(dx,dy); if (dist < 140){ if (dx < 0) this.x += 3; else this.x -= 3; } } this.x = Math.max(0, Math.min(this.x, canvas.width - this.width)); }
    }

    class PowerUp {
      constructor(image,w,h){ this.image=image; this.width=w; this.height=h; this.x=Math.random()*(canvas.width-this.width); this.y=-this.height - Math.random()*200; this.speed=2; }
      update(){ this.y += this.speed; } draw(){ ctx.drawImage(this.image,this.x,this.y,this.width,this.height); }
    }
    class ShieldPowerUp extends PowerUp { constructor(){ super(assets.shieldPowerUp,40,40); } }
    class FuelPowerUp extends PowerUp { constructor(){ super(assets.fuelPowerUp,40,40); } }

    let player = new Player();
    let competitors = [];
    let powerUps = [];
    let competitorSpawnTimer = 100;
    let powerUpSpawnTimer = 500;
    let lastTime = 0;

    function resetGame(){
      player = new Player(); competitors = []; powerUps = []; score = 0; gameOver = false; gameStarted = true; competitorSpawnTimer = 100; powerUpSpawnTimer = 500; lastTime = performance.now(); requestAnimationFrame(gameLoop);
    }

    function checkCollisions(){
      // Bullets vs competitors
      for (let b = player.bullets.length-1; b>=0; b--){
        const bullet = player.bullets[b];
        for (let c = competitors.length-1; c>=0; c--){
          const comp = competitors[c];
          if (bullet.x < comp.x + comp.width && bullet.x + bullet.width > comp.x && bullet.y < comp.y + comp.height && bullet.y + bullet.height > comp.y){
            player.bullets.splice(b,1); competitors.splice(c,1); score += 10; collisionSound.triggerAttackRelease('G3','16n'); break;
          }
        }
      }

      // Player vs competitors
      if (!player.shieldActive){
        for (let comp of competitors){
          if (player.x < comp.x + comp.width && player.x + player.width > comp.x && player.y < comp.y + comp.height && player.y + player.height > comp.y){
            collisionSound.triggerAttackRelease('C2','8n'); gameOver = true; return;
          }
        }
      } else {
        for (let i = competitors.length-1; i>=0; i--){
          const comp = competitors[i];
          if (player.x < comp.x + comp.width && player.x + player.width > comp.x && player.y < comp.y + comp.height && player.y + player.height > comp.y){
            competitors.splice(i,1); score += 5; pickupSound.triggerAttackRelease('E4','8n');
          }
        }
      }

      // Player vs powerups
      for (let p = powerUps.length-1; p>=0; p--){
        const pu = powerUps[p];
        if (player.x < pu.x + pu.width && player.x + player.width > pu.x && player.y < pu.y + pu.height && player.y + player.height > pu.y){
          powerUps.splice(p,1);
          if (pu instanceof ShieldPowerUp){ player.activateShield(); pickupSound.triggerAttackRelease('B4','8n'); }
          else if (pu instanceof FuelPowerUp){ player.addFuel(45); pickupSound.triggerAttackRelease('D5','8n'); }
        }
      }
    }

    function spawnCompetitor(){ const r = Math.random(); if (r < 0.5) return new Asteroid(); if (r < 0.8) return new Chaser(); return new Dodger(); }
    function spawnPowerUp(){ return Math.random() < 0.5 ? new ShieldPowerUp() : new FuelPowerUp(); }

    const starField = [];
    for (let i=0;i<80;i++){ starField.push({ x:Math.random()*canvas.width, y:Math.random()*canvas.height, r:Math.random()*1.5, speed:0.2 + Math.random()*0.6 }); }
    function drawStars(){ ctx.fillStyle='#000'; ctx.fillRect(0,0,canvas.width,canvas.height); for (let s of starField){ ctx.fillStyle='rgba(180,220,255,0.6)'; ctx.beginPath(); ctx.arc(s.x,s.y,s.r,0,Math.PI*2); ctx.fill(); s.y += s.speed; s.x += Math.sin(s.y*0.01)*0.3; if (s.y > canvas.height){ s.y = -2; s.x = Math.random()*canvas.width; } } }

    function drawHUD(){
      ctx.fillStyle='#00ffff'; ctx.font='20px Orbitron,monospace'; ctx.fillText(`Score: ${score}`, 12, 28);

      const barW = 220, barH = 14, barX = canvas.width - barW - 12, barY = 12;
      ctx.strokeStyle = '#00ffff'; ctx.lineWidth = 2; ctx.strokeRect(barX, barY, barW, barH);
      const fuelPct = player.fuel / player.maxFuel;
      const grad = ctx.createLinearGradient(barX,0,barX+barW,0); grad.addColorStop(0,'#00ffbe'); grad.addColorStop(1,'#00ffff');
      ctx.fillStyle = grad; ctx.fillRect(barX+1, barY+1, Math.max(0,(barW-2)*fuelPct), barH-2);

      if (player.shieldActive){ ctx.fillStyle='#66ffcc'; ctx.font='14px Orbitron,monospace'; ctx.fillText('Shield: ON', barX, barY + barH + 20); }
    }

    function showStartScreen(){
      const overlay = document.getElementById('overlayText');
      overlay.innerHTML = "<div style='font-size:18px'>Press Space or Z to Start<br/>Arrow keys or A/D to move<br/>Tap/click canvas to enable audio</div>";
      function startHandler(e){
        if (e.type === 'keydown' && !(e.code === 'Space' || e.code === 'KeyZ')) return;
        if (Tone.context.state !== 'running') Tone.start();
        overlay.innerHTML = '';
        window.removeEventListener('keydown', startHandler);
        canvas.removeEventListener('click', startHandler);
        resetGame();
      }
      window.addEventListener('keydown', startHandler);
      canvas.addEventListener('click', startHandler, { once: true });
    }

    function showGameOver(){
      const overlay = document.getElementById('overlayText');
      overlay.innerHTML = `<div style="font-size:24px">GAME OVER</div><div style="margin-top:8px;font-size:18px">Score: ${score}</div><div style="margin-top:12px;font-size:16px">Press R to Restart</div>`;
      function restart(e){ if (e.key === 'r' || e.key === 'R'){ overlay.innerHTML=''; window.removeEventListener('keydown', restart); resetGame(); } }
      window.addEventListener('keydown', restart);
    }

    function gameLoop(timestamp){
      if (!gameStarted) return;
      const delta = timestamp - lastTime;
      lastTime = timestamp;

      // Clear + background
      drawStars();

      // Update
      player.update(delta);
      competitorSpawnTimer -= 1 + Math.min(2, Math.floor(score/100));
      if (competitorSpawnTimer <= 0){ competitors.push(spawnCompetitor()); competitorSpawnTimer = Math.max(30, 100 - Math.floor(score/20)); }

      powerUpSpawnTimer--;
      if (powerUpSpawnTimer <= 0){ powerUps.push(spawnPowerUp()); powerUpSpawnTimer = 400 + Math.floor(Math.random()*400); }

      for (let i=competitors.length-1;i>=0;i++){ competitors[i].update(); if (competitors[i].y > canvas.height + 100) competitors.splice(i,1); }
      for (let i=powerUps.length-1;i>=0;i++){ powerUps[i].update(); if (powerUps[i].y > canvas.height + 50) powerUps.splice(i,1); }

      checkCollisions();

      // Draw all
      player.draw();
      competitors.forEach(c=>c.draw());
      powerUps.forEach(p=>p.draw());
      drawHUD();

      if (!gameOver) requestAnimationFrame(gameLoop);
      else showGameOver();
    }

    // Input
    window.addEventListener('keydown', (e) => {
      keys[e.code] = true;
      if (e.code === 'Space') e.preventDefault();
      if (!gameStarted && (e.code === 'Space' || e.code === 'KeyZ')) {
        if (Tone.context.state !== 'running') Tone.start();
        document.getElementById('overlayText').innerHTML = '';
        resetGame();
      }
    });
    window.addEventListener('keyup', (e) => { keys[e.code] = false; });

    canvas.addEventListener('click', () => {
      if (!gameStarted) {
        if (Tone.context.state !== 'running') Tone.start();
        document.getElementById('overlayText').innerHTML = '';
        resetGame();
      }
    });

    // Start
    showStartScreen();

    // For convenience in console
    window._resetSpaceShooter = resetGame;
  </script>
</body>
</html>
